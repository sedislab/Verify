# LTL Formula Generation and Processing Utilities

This directory contains the Python scripts for generating, processing, converting, verifying, and canonicalizing Linear Temporal Logic (LTL) formulas. It was developed as part of VERIFY.

## Key Scripts

* **`enumerate_ltl.py`**:
    * Defines the core LTL `Formula` structure and `Operator` enums.
    * Contains the `LTLGenerator` class for systematically or randomly generating LTL formulas.
    * Includes logic for internal canonicalization (NNF, expanding implications, associative/distributive laws, sorting) to produce a custom canonical hash for de-duplication during generation.
    * Features `FormulaStorage` for persisting generated formulas to an SQLite database.
* **`canonicalize_ltl_with_spot.py`**:
    * Provides the `FormulaParser` class to convert LTL formulas from a LaTeX-like string representation (as might be generated by `enumerate_ltl.py`) into the syntax required by the Spot model checking library.
    * Includes the `validate_with_spot` function, which uses the `spot` library to:
        1.  Verify the syntactic correctness of an LTL formula string.
        2.  Obtain Spot's own canonical string representation of the formula.
    * Contains functionality to update an SQLite database (produced by `enumerate_ltl.py`) with these Spot-verified and Spot-canonicalized forms.
* **`ltl_gen_example.py`**:
    * An example script demonstrating how to use `LTLGenerator` from `enumerate_ltl.py` to generate formulas and `FormulaParser` and `validate_with_spot` from `canonicalize_ltl_with_spot.py` to process and verify them.
    * This script prints results to the console and does not interact with file storage, serving as a clear usage example.

## Getting Started

There are two main ways to use these scripts:

### Option 1: Using as a Library (Recommended for Custom Workflows)

This is the most flexible approach, allowing you to integrate the LTL generation and processing capabilities into your own Python projects and workflows.

1.  **Ensure the Scripts are Accessible**: Place `enumerate_ltl.py` and `canonicalize_ltl_with_spot.py` in your project directory or ensure they are in your `PYTHONPATH`.
2.  **Import Required Classes/Functions**: In your custom Python script, import the components you need.

    ```python
    # In your_custom_script.py
    from enumerate_ltl import LTLGenerator, Formula
    from canonicalize_ltl_with_spot import FormulaParser, validate_with_spot

    # Example: Generate one formula and process it
    ltl_gen = LTLGenerator(max_depth=3, storage_dir=None) # Configure as needed
    formula_obj = ltl_gen._generate_formula(depth=0) # Use internal method for direct object generation

    latex_str = formula_obj.to_latex()
    print(f"Generated LaTeX: {latex_str}")

    parser = FormulaParser()
    spot_syntax_str = parser.parse(latex_str)
    print(f"Spot Syntax: {spot_syntax_str}")

    is_valid, spot_canonical = validate_with_spot(spot_syntax_str)
    if is_valid:
        print(f"Spot Valid & Canonical: {spot_canonical}")
    else:
        print(f"Spot Invalid: {spot_canonical}")
    ```
3.  **Refer to `ltl_gen_example.py`**: This script provides a practical demonstration of importing and using the functionalities to generate, convert, and verify formulas without database interaction, printing all steps to the console.

### Option 2: Modifying and Running Scripts Directly

The provided scripts (`enumerate_ltl.py` and `canonicalize_ltl_with_spot.py`) are designed to be run directly for specific tasks, such as large-scale dataset generation or batch processing of formulas in a database.

1.  **Configure Constants/Variables**:
    * Open the script you intend to run (e.g., `enumerate_ltl.py` or `canonicalize_ltl_with_spot.py`).
    * At the top of the script, or within its `main()` function, you will find configuration variables (e.g., `DATA_DIRECTORY`, `LOGS_DIRECTORY`, `BATCH_SIZE`, `target_count`, `max_depth`).
    * Modify these variables to suit your needs (e.g., change file paths, the number of formulas to generate, etc.).
2.  **Run the Script**:
    * Execute the script from your terminal using Python.

    **Example for `enumerate_ltl.py`:**
    ```bash
    # First, modify target_count, max_depth, storage_dir etc. inside enumerate_ltl.py
    python enumerate_ltl.py
    ```

    **Example for `canonicalize_ltl_with_spot.py`:**
    ```bash
    # First, modify DATA_DIRECTORY, LOGS_DIRECTORY, BATCH_SIZE etc. inside canonicalize_ltl_with_spot.py
    python canonicalize_ltl_with_spot.py
    ```

## Running the Example Script

The `ltl_gen_example.py` script is ready to run and demonstrates the core workflow:

1.  Make sure `enumerate_ltl.py` and `canonicalize_ltl_with_spot.py` are in the same directory.
2.  Ensure you have the Spot library installed and working.
3.  Run the example from your terminal:
    ```bash
    python ltl_gen_example.py
    ```
    This will print the generation, conversion, and verification steps for 10 sample LTL formulas directly to your console.

## Key Features

* **LTL Formula Generation**: Create diverse LTL formulas with control over depth and atomic propositions.
* **Internal Canonicalization**: `enumerate_ltl.py` provides a custom canonicalization routine for de-duplication during its generation process.
* **LaTeX Conversion**: Convert `Formula` objects to human-readable LaTeX strings.
* **Spot Syntax Conversion**: Parse LaTeX-like LTL strings into Spot-compatible syntax.
* **Spot-based Verification**: Leverage the Spot library to confirm the syntactic validity of LTL formulas.
* **Spot-based Canonicalization**: Obtain Spot's official canonical string representation for verified formulas.
* **Database Integration**: Scripts are designed for large-scale generation and processing with SQLite database storage.
